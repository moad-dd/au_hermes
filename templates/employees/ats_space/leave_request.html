{% extends 'base.html' %}

{% block title %}Leave Request - AU HERMES{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="text-center mb-4">
    <h2 class="fw-bold text-primary">
      <i class="bi bi-calendar-check-fill me-2"></i> Leave Request
    </h2>
    <p class="text-muted">Submit your leave request and track its status</p>
  </div>

  <!-- Leave Request Form -->
  <div class="row justify-content-center mb-5">
    <div class="col-md-8">
      <div class="card shadow-sm border-0" style="border-radius: 15px;">
        <div class="card-body p-4">
          <h5 class="fw-bold mb-4">Submit New Request</h5>
          <form method="POST">
            {% csrf_token %}
            
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Leave Type</label>
                {{ form.leave_type }}
              </div>
              
              <div class="col-md-6">
                <label class="form-label">Duration</label>
                <input type="text" class="form-control" readonly value="Calculated after dates">
              </div>

              <div class="col-md-6">
                <label class="form-label">Start Date</label>
                {{ form.start_date }}
              </div>

              <div class="col-md-6">
                <label class="form-label">End Date</label>
                {{ form.end_date }}
              </div>

              <div class="col-12">
                <label class="form-label">Reason</label>
                {{ form.reason }}
              </div>
            </div>

            <div class="text-center mt-4">
              <button type="submit" class="btn btn-warning px-5 py-2 fw-bold">
                <i class="bi bi-send-fill me-2"></i> Submit Request
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Previous Requests -->
  <div class="row justify-content-center">
    <div class="col-md-10">
      <h4 class="fw-bold text-center mb-4">
        <i class="bi bi-clock-history me-2"></i> Your Leave Requests
      </h4>

      {% if user_requests %}
      <div class="table-responsive">
        <table class="table table-hover align-middle shadow-sm">
          <thead class="table-dark">
            <tr>
              <th>Type</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Duration</th>
              <th>Status</th>
              <th>Submitted</th>
            </tr>
          </thead>
          <tbody>
            {% for request in user_requests %}
            <tr>
              <td>{{ request.get_leave_type_display }}</td>
              <td>{{ request.start_date|date:"M d, Y" }}</td>
              <td>{{ request.end_date|date:"M d, Y" }}</td>
              <td>{{ request.duration }} day{{ request.duration|pluralize }}</td>
              <td>
                {% if request.status == 'Approved' %}
                <span class="badge bg-success">✓ Approved</span>
                {% elif request.status == 'Pending' %}
                <span class="badge bg-warning text-dark">⏳ Pending</span>
                {% else %}
                <span class="badge bg-danger">✗ Rejected</span>
                {% endif %}
              </td>
              <td>{{ request.date_submitted|date:"M d, Y" }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="text-center text-muted py-5">
        <i class="bi bi-inbox" style="font-size: 3rem;"></i>
        <p class="mt-3">No leave requests found. Submit your first request above!</p>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}